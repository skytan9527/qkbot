# å¿«é€Ÿæ”¹è¿›æ¸…å•ï¼ˆå¯ç«‹å³å®æ–½ï¼‰

## ğŸš€ ä¼˜å…ˆçº§æœ€é«˜çš„æ”¹è¿›ï¼ˆå»ºè®®å…ˆåšï¼‰

### 1. ç”¨æˆ·ä½¿ç”¨ç»Ÿè®¡ï¼ˆ2-3å¤©ï¼‰
**åŠŸèƒ½**ï¼šè®°å½•ç”¨æˆ·æ“ä½œæ•°æ®
- [ ] åˆ›å»ºæ•°æ®å­˜å‚¨ï¼ˆJSONæ–‡ä»¶æˆ–SQLiteæ•°æ®åº“ï¼‰
- [ ] è®°å½•ç”¨æˆ·æ“ä½œï¼ˆè½¬å­˜/æœç´¢/åˆ†äº«ï¼‰
- [ ] æ·»åŠ  `/stats` å‘½ä»¤æŸ¥çœ‹ä¸ªäººç»Ÿè®¡
- [ ] æ·»åŠ  `/my` å‘½ä»¤æŸ¥çœ‹æˆ‘çš„æ•°æ®

**ä»£ç ä½ç½®**ï¼š
- åœ¨ `quark_app.py` çš„ `_handle_message` æ–¹æ³•ä¸­æ·»åŠ ç»Ÿè®¡é€»è¾‘
- åˆ›å»º `stats_manager.py` æ¨¡å—å¤„ç†ç»Ÿè®¡æ•°æ®

---

### 2. æ¨å¹¿ç´ æåº“ï¼ˆ1-2å¤©ï¼‰
**åŠŸèƒ½**ï¼šå¿«é€Ÿè·å–æ¨å¹¿å†…å®¹
- [ ] åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç´ æåº“æ–‡ä»¶å¤¹é…ç½®
- [ ] æ·»åŠ  `/material` å‘½ä»¤ï¼Œæ”¯æŒåˆ†ç±»å‚æ•°
- [ ] æ·»åŠ  `/hot` å‘½ä»¤ï¼Œæ˜¾ç¤ºçƒ­é—¨å†…å®¹
- [ ] ä¼˜åŒ–ç´ æå±•ç¤ºï¼ˆå¡ç‰‡å½¢å¼ï¼‰

**ä»£ç ä½ç½®**ï¼š
- åœ¨ `quark_app.py` ä¸­æ·»åŠ ç´ æåº“ç›¸å…³æ–¹æ³•
- åœ¨ `parse_wechat_message` ä¸­æ·»åŠ æ–°å‘½ä»¤è§£æ

---

### 3. çƒ­é—¨å†…å®¹ç»Ÿè®¡ï¼ˆ1-2å¤©ï¼‰
**åŠŸèƒ½**ï¼šç»Ÿè®¡æœ€å—æ¬¢è¿çš„å†…å®¹
- [ ] è®°å½•æ¯ä¸ªæ–‡ä»¶çš„è½¬å­˜æ¬¡æ•°
- [ ] è®°å½•æ¯ä¸ªæ–‡ä»¶çš„åˆ†äº«æ¬¡æ•°
- [ ] æ·»åŠ  `/hot` å‘½ä»¤æ˜¾ç¤ºTOP 10
- [ ] æ·»åŠ  `/rank` å‘½ä»¤æ˜¾ç¤ºæ’è¡Œæ¦œ

**ä»£ç ä½ç½®**ï¼š
- åœ¨è½¬å­˜å’Œåˆ†äº«æ—¶è®°å½•ç»Ÿè®¡æ•°æ®
- æ·»åŠ æ’è¡Œæ¦œæŸ¥è¯¢æ–¹æ³•

---

### 4. åˆ†äº«é“¾æ¥æ¶ˆæ¯ä¼˜åŒ–ï¼ˆåŠå¤©ï¼‰
**åŠŸèƒ½**ï¼šç¾åŒ–åˆ†äº«é“¾æ¥å±•ç¤º
- [ ] æ·»åŠ æ–‡ä»¶ç±»å‹å›¾æ ‡ï¼ˆğŸ“ ğŸ“„ ğŸ¬ ğŸµ ğŸ“· ç­‰ï¼‰
- [ ] æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] æ˜¾ç¤ºåˆ›å»ºæ—¶é—´
- [ ] ä¼˜åŒ–å¡ç‰‡æ¶ˆæ¯æ ¼å¼

**ä»£ç ä½ç½®**ï¼š
- åœ¨ `create_share_from_search` å’Œ `process_share_url` æ–¹æ³•ä¸­ä¼˜åŒ–æ¶ˆæ¯æ ¼å¼

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ•°æ®ç»Ÿè®¡åŸºç¡€ï¼ˆæœ€ç®€å•ï¼Œå…ˆåšï¼‰

1. **åˆ›å»ºç»Ÿè®¡æ¨¡å—** (`stats_manager.py`)
```python
import json
import os
from datetime import datetime
from typing import Dict, List

class StatsManager:
    def __init__(self, stats_file: str = './config/stats.json'):
        self.stats_file = stats_file
        self.stats = self.load_stats()
    
    def load_stats(self) -> dict:
        # åŠ è½½ç»Ÿè®¡æ•°æ®
        pass
    
    def record_operation(self, user_id: str, operation: str, data: dict):
        # è®°å½•æ“ä½œ
        pass
    
    def get_user_stats(self, user_id: str) -> dict:
        # è·å–ç”¨æˆ·ç»Ÿè®¡
        pass
```

2. **åœ¨å…³é”®ä½ç½®æ·»åŠ ç»Ÿè®¡è®°å½•**
   - è½¬å­˜æˆåŠŸæ—¶è®°å½•
   - ç”Ÿæˆåˆ†äº«é“¾æ¥æ—¶è®°å½•
   - æœç´¢æ—¶è®°å½•

3. **æ·»åŠ ç»Ÿè®¡å‘½ä»¤**
   - `/stats` - æŸ¥çœ‹æˆ‘çš„ç»Ÿè®¡
   - `/rank` - æŸ¥çœ‹æ’è¡Œæ¦œ

---

### ç¬¬äºŒæ­¥ï¼šæ¨å¹¿ç´ æåº“

1. **é…ç½®ç´ æåº“æ–‡ä»¶å¤¹**
```json
{
  "material_folders": {
    "å½±è§†": "folder_id_1",
    "è½¯ä»¶": "folder_id_2",
    "å­¦ä¹ ": "folder_id_3"
  }
}
```

2. **æ·»åŠ ç´ æåº“å‘½ä»¤**
   - `/material` - åˆ—å‡ºæ‰€æœ‰åˆ†ç±»
   - `/material å½±è§†` - è·å–å½±è§†åˆ†ç±»çš„å†…å®¹

3. **ä¼˜åŒ–å±•ç¤º**
   - ä½¿ç”¨å¡ç‰‡æ¶ˆæ¯å±•ç¤ºç´ æåˆ—è¡¨
   - æ”¯æŒå¿«é€Ÿåˆ†äº«

---

### ç¬¬ä¸‰æ­¥ï¼šçƒ­é—¨å†…å®¹ç»Ÿè®¡

1. **è®°å½•å†…å®¹çƒ­åº¦**
   - æ–‡ä»¶è½¬å­˜æ¬¡æ•°
   - æ–‡ä»¶åˆ†äº«æ¬¡æ•°
   - æœç´¢å…³é”®è¯çƒ­åº¦

2. **æ·»åŠ çƒ­é—¨å‘½ä»¤**
   - `/hot` - ä»Šæ—¥çƒ­é—¨
   - `/hot æœ¬å‘¨` - æœ¬å‘¨çƒ­é—¨
   - `/hot æœ¬æœˆ` - æœ¬æœˆçƒ­é—¨

---

## ğŸ› ï¸ ä»£ç ä¿®æ”¹ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ·»åŠ ç»Ÿè®¡è®°å½•

åœ¨ `quark_app.py` çš„ `_handle_message` æ–¹æ³•ä¸­ï¼š

```python
# åœ¨è½¬å­˜æˆåŠŸæ—¶
if msg_type == 'url':
    result = await self.app_handler.process_share_url(msg_content, touser=from_user)
    if result.get('success'):
        # è®°å½•ç»Ÿè®¡
        self.stats_manager.record_operation(
            from_user, 
            'transfer', 
            {'file_count': result.get('files_count', 0)}
        )
```

### ç¤ºä¾‹2ï¼šæ·»åŠ æ–°å‘½ä»¤

åœ¨ `parse_wechat_message` å‡½æ•°ä¸­ï¼š

```python
# ç»Ÿè®¡å‘½ä»¤
if text.lower() in ['/stats', '/my', '/ç»Ÿè®¡', 'æˆ‘çš„ç»Ÿè®¡']:
    return {'type': 'stats', 'content': ''}

# çƒ­é—¨å‘½ä»¤
if text.lower().startswith('/hot'):
    period = text[4:].strip() or 'ä»Šæ—¥'
    return {'type': 'hot', 'content': period}

# ç´ æå‘½ä»¤
if text.lower().startswith('/material'):
    category = text[9:].strip()
    return {'type': 'material', 'content': category}
```

### ç¤ºä¾‹3ï¼šå¤„ç†æ–°å‘½ä»¤

åœ¨ `_handle_message` æ–¹æ³•ä¸­ï¼š

```python
elif msg_type == 'stats':
    stats = self.stats_manager.get_user_stats(from_user)
    # æ ¼å¼åŒ–å¹¶å‘é€ç»Ÿè®¡æ•°æ®
    
elif msg_type == 'hot':
    hot_content = self.stats_manager.get_hot_content(msg_content)
    # å‘é€çƒ­é—¨å†…å®¹åˆ—è¡¨
    
elif msg_type == 'material':
    materials = self.app_handler.get_materials(msg_content)
    # å‘é€ç´ æåˆ—è¡¨
```

---

## ğŸ“Š æ•°æ®å­˜å‚¨å»ºè®®

### æ–¹æ¡ˆ1ï¼šJSONæ–‡ä»¶ï¼ˆç®€å•å¿«é€Ÿï¼‰
- ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ— éœ€æ•°æ®åº“
- ç¼ºç‚¹ï¼šå¹¶å‘æ€§èƒ½å·®ï¼Œé€‚åˆå°è§„æ¨¡ä½¿ç”¨
- æ–‡ä»¶ï¼š`config/stats.json`

### æ–¹æ¡ˆ2ï¼šSQLiteæ•°æ®åº“ï¼ˆæ¨èï¼‰
- ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢
- ç¼ºç‚¹ï¼šéœ€è¦SQLçŸ¥è¯†
- æ–‡ä»¶ï¼š`config/stats.db`

### æ•°æ®ç»“æ„ç¤ºä¾‹ï¼ˆJSONï¼‰
```json
{
  "users": {
    "user_id_1": {
      "transfer_count": 10,
      "share_count": 5,
      "search_count": 3,
      "last_active": "2024-01-05 19:00:00"
    }
  },
  "files": {
    "file_id_1": {
      "transfer_count": 20,
      "share_count": 15,
      "name": "æ–‡ä»¶å"
    }
  },
  "daily_stats": {
    "2024-01-05": {
      "total_transfers": 100,
      "total_shares": 50
    }
  }
}
```

---

## âœ… æ£€æŸ¥æ¸…å•

å®æ–½å‰ï¼š
- [ ] ç¡®å®šæ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼ˆJSON/SQLiteï¼‰
- [ ] è®¾è®¡æ•°æ®ç»“æ„
- [ ] è§„åˆ’å‘½ä»¤æ ¼å¼

å®æ–½ä¸­ï¼š
- [ ] åˆ›å»ºç»Ÿè®¡æ¨¡å—
- [ ] æ·»åŠ ç»Ÿè®¡è®°å½•é€»è¾‘
- [ ] æ·»åŠ æ–°å‘½ä»¤è§£æ
- [ ] æ·»åŠ å‘½ä»¤å¤„ç†é€»è¾‘
- [ ] æµ‹è¯•åŠŸèƒ½

å®æ–½åï¼š
- [ ] éªŒè¯æ•°æ®è®°å½•æ­£ç¡®
- [ ] æµ‹è¯•å‘½ä»¤å“åº”
- [ ] ä¼˜åŒ–æ€§èƒ½ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
- [ ] æ›´æ–°æ–‡æ¡£

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

å®æ–½è¿™äº›æ”¹è¿›åï¼š
1. **ç”¨æˆ·æ´»è·ƒåº¦æå‡**ï¼šç»Ÿè®¡å’Œæ’è¡Œæ¦œæ¿€å‘ç”¨æˆ·ä½¿ç”¨
2. **æ¨å¹¿æ•ˆç‡æå‡**ï¼šç´ æåº“å¿«é€Ÿè·å–æ¨å¹¿å†…å®¹
3. **æ•°æ®é©±åŠ¨å†³ç­–**ï¼šäº†è§£ç”¨æˆ·åå¥½ï¼Œä¼˜åŒ–æ¨å¹¿ç­–ç•¥
4. **ç”¨æˆ·ä½“éªŒæ”¹å–„**ï¼šæ›´å¤šå¿«æ·å‘½ä»¤ï¼Œæ›´å‹å¥½çš„ç•Œé¢

